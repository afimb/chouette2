<% text_color = @line.text_color.blank? ? "black" : "##{@line.text_color}" %>
<% bg_color = @line.color.blank? ? "white" : "#"+@line.color %>

<%= title_tag t('lines.show.title', :line => @line.name ) %>

<div class="line_show">
  <%= @map.to_html %>

  <div class="summary">
    <% text_color = @line.text_color.blank? ? "black" : "##{@line.text_color}" %>
    <% bg_color = @line.color.blank? ? "white" : "#"+@line.color %>
    <% if colors?(@line) %>
	    <p>
	    	<label><%= t('lines.index.color') %>: </label>
	    	<label class="color" style='<%="#{number_style(@line)}"%>'><%= line_sticker(@line) %></label>
	    </p>
    <% end %>
    <p>
      <label><%= @line.human_attribute_name(:network) %>: </label>
  	<% if @line.network.nil? %>
  	   <%= t('lines.index.unset') %>
  	<% else %>
      <%= link_to @line.network.name, [@referential, @line.network] %>
    <% end %>
    </p>
    <p>
      <label><%= t('lines.operator') %>: </label>
  	<% if @line.company.nil? %>
  	   <%= t('lines.index.unset') %>
  	<% else %>
      <%= link_to @line.company.name, [@referential, @line.company] %>
    <% end %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("number") %>: </label>
      <%= @line.number %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("published_name") %>: </label>
      <%= @line.published_name %>
    </p>

    <p>
      <label><%= @line.human_attribute_name("transport_mode") %>: </label>
      <%= t("transport_modes.label.#{@line.transport_mode}") %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("transport_submode") %>: </label>
      <% if @line.transport_submode.nil? %>
    	<% else %>
      <%= t("transport_sub_modes.label.#{@line.transport_submode}") %>
      <% end %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("stable_id") %>: </label>
      <%= @line.stable_id %>
    </p>

    <p>
      <label><%= @line.human_attribute_name("mobility_restricted_suitability") %> : </label>
      <% if @line.mobility_restricted_suitability.nil? %>
      <%= @line.human_attribute_name("unspecified_mrs") %>
      <% elsif @line.mobility_restricted_suitability? %>
      <%= @line.human_attribute_name("accessible") %>
      <% else %>
      <%= @line.human_attribute_name("not_accessible") %>
      <% end %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_mrs_vj") %> : <%= @line.vehicle_journeys.where("mobility_restricted_suitability = ?", true).count %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_non_mrs_vj") %> : <%= @line.vehicle_journeys.where("mobility_restricted_suitability = ?", false).count %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_null_mrs_vj") %> : <%= @line.vehicle_journeys.count -
										       (@line.vehicle_journeys.where("mobility_restricted_suitability = ?", true).count +
										       @line.vehicle_journeys.where("mobility_restricted_suitability = ?", false).count) %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("flexible_service") %> : </label>
      <% if @line.flexible_service.nil? %>
      <%= @line.human_attribute_name("unspecified_fs") %>
      <% elsif @line.flexible_service? %>
      <%= @line.human_attribute_name("on_demaond_fs") %>
      <% else %>
      <%= @line.human_attribute_name("regular_fs") %>
      <% end %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_fs_vj") %> : <%= @line.vehicle_journeys.where("flexible_service = ?", true).count %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_non_fs_vj") %> : <%= @line.vehicle_journeys.where("flexible_service = ?", false).count %>
      <br>&nbsp;&nbsp;<%= @line.human_attribute_name("number_of_null_fs_vj") %>
      <% if @line.flexible_service.nil? %>
      (<%= @line.human_attribute_name("default_fs_msg") %>)
      <% end %>
      : <%= @line.vehicle_journeys.count -
	    (@line.vehicle_journeys.where("flexible_service = ?", true).count +
	    @line.vehicle_journeys.where("flexible_service = ?", false).count) %>

      <% if @line.flexible_service? %>
          <div class="row">
            <div id="flexible_service" class="col-md-6">
        <p>
          <label><%= @line.human_attribute_name("flexible_line_type") %>: </label>
          <%= @line.flexible_line_type %>
        </p>
        <p>
          <label><%= @line.human_attribute_name("booking_access") %>: </label>
          <%= @line.booking_access %>
        </p>
          <p>
            <label><%= @line.human_attribute_name("book_when") %>: </label>
            <%= @line.book_when %>
          </p>
          <p>
            <label><%= @line.human_attribute_name("buy_when") %>: </label>
            <% @line.buy_when.each do |buy_when| %>
                <%= buy_when %>
            <% end %>
          </p>
          <p>
            <label><%= @line.human_attribute_name("booking_methods") %>: </label>
            <% @line.booking_methods.each do |booking_method| %>
                <%= booking_method %>
            <% end %>
          </p>
          <p>
            <label><%= @line.human_attribute_name("latest_booking_time") %>: </label>
            <%= @line.latest_booking_time %>
          </p>
          <p>
            <label><%= @line.human_attribute_name("minimum_booking_period") %>: </label>
            <%= @line.minimum_booking_period %>
          </p>
          <p>
            <label><%= @line.human_attribute_name("booking_note") %>: </label>
            <%= @line.booking_note %>
          </p>
          </div>
          <div id="flexible_service" class="col-md-6">
            <p>
          <h3><%= @line.human_attribute_name("booking_contact") %>: </h3>
            </p>
          <% unless @line.booking_contact.nil? %>
            <p>
              <label><%= @line.human_attribute_name("contact_person") %>: </label>
              <%= @line.booking_contact.contact_person %>
            </p>
            <p>
              <label><%= @line.human_attribute_name("phone") %>: </label>
              <%= @line.booking_contact.phone %>
            </p>
            <p>
              <label><%= @line.human_attribute_name("url") %>: </label>
              <%= @line.booking_contact.url %>
            </p>
            <p>
              <label><%= @line.human_attribute_name("email") %>: </label>
              <%= @line.booking_contact.email %>
            </p>
            <p>
              <label><%= @line.human_attribute_name("fax") %>: </label>
              <%= @line.booking_contact.fax %>
            </p>
              <p>
              <label><%= @line.human_attribute_name("further_detail") %>: </label>
              <%= @line.booking_contact.further_details %>
              </p>

        <% end %>
          </div>
          </div>
      <% end %>


    <p>
      <label><%= @line.human_attribute_name("comment") %>: </label>
      <%= @line.comment %>
    </p>
    <p>
      <label><%= @line.human_attribute_name("footnote") %>: </label>
    <ul>
      <% @line.footnotes.each do |footnote| %>
        <li><%= footnote.code %> : <%= footnote.label %></li>
      <% end %>
    </ul>
    </p>

    <p>
      <label><%= @line.human_attribute_name(:key_values) %>: </label>
    </p>
      <% unless @line.lines_key_values.nil? %>
        <ul>
          <% @line.lines_key_values.each do |key_value| %>
              <li><%= key_value.key %> - <%= key_value.value %></li>
          <% end %>
        </ul>
    <% end %>
  </div>

  <div class="row">
    <div id="mobility_restricted_suitability" class="col-md-6"></div>
    <div id="flexible_service" class="col-md-6"></div>
  </div>
</div>

<p class="after_map" />
<h3 class="routes"><%= t('.itineraries') %></h3>
<div class="routes paginated_content">
  <%= paginated_content @routes, "routes/route" %>
</div>

<% if @line.group_of_lines.any? %>
  <h3 class="line_group_of_lines"><%= t('.group_of_lines') %></h3>
  <div class="group_of_lines paginated_content">
     <%= paginated_content @group_of_lines, "group_of_lines/group_of_line", :delete => false %>
  </div>
<% end %>

<% content_for :sidebar do %>
<ul class="actions">
  <li><%= link_to t('lines.actions.new'), new_referential_line_path(@referential), :class => "add" %></li>
  <li><%= link_to t('lines.actions.edit'), edit_referential_line_path(@referential, @line), :class => "edit" %></li>
  <li><%= link_to t('lines.actions.destroy'), referential_line_path(@referential, @line), :method => :delete, :data => {:confirm =>  t('lines.actions.destroy_confirm')}, :class => "remove" %></li>
  <% if !@line.format_restricted?(:hub) || (@line.format_restricted?(:hub) && @line.routes.size < 2) %>
    <li><%= link_to t('routes.actions.new'), new_referential_line_route_path(@referential, @line), :class => "add" %></li>
  <% end %>
</ul>
  <%= creation_tag(@line) %>
<% end %>
