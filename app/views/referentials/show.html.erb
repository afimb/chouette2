<%= title_tag @referential.name %>

<div class="summary">
  <p>
  <label><%= Referential.human_attribute_name("slug") %>: </label>
  <%= @referential.slug %>
  </p>
  <p>
  <label><%= Referential.human_attribute_name("prefix") %>: </label>
  <%= @referential.prefix %>
  </p>
  <p>
  <label><%= Referential.human_attribute_name("projection_type") %>: </label>
  <%= @referential.projection_type %>
  </p>
  <p>
  <label><%= Referential.human_attribute_name("time_zone").capitalize %>: </label>
  <%= @referential.time_zone %>
  </p>
  <p>
  	<label><%= Referential.human_attribute_name("validity_period") %>: </label>
  	<% if Chouette::TimeTable.start_validity_period.nil? %>
  	 <%= Referential.human_attribute_name("no_validity_period") %>
  	<% else %>
     <%= Referential.human_attribute_name("start_validity_period") %>
     <%= l Chouette::TimeTable.start_validity_period %>
     <%= Referential.human_attribute_name("end_validity_period") %>
     <%= l Chouette::TimeTable.end_validity_period %>
   <% end %>
  </p>
  
  <table width="100%">
  	<tr>
  	  <td valign="top" width="50%">	
  <table class="count" width="75%"> 
  	<thead>
  		<tr>
  		<td  colspan="2"><%= t(".objects") %></td>
  		<td><%= t(".count") %></td>		
  		</tr>
  	</thead>
  	<tbody>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("networks") %></td>
  		<td class="value"> <%= @referential.networks.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("companies") %></td>
  		<td class="value"> <%= @referential.companies.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("lines") %></td>
  		<td class="value"> <%= @referential.lines.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("vehicle_journeys") %></td>
  		<td class="value"> <%= @referential.vehicle_journeys.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("time_tables") %></td>
  		<td class="value"> <%= @referential.time_tables.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("connection_links") %></td>
  		<td class="value"> <%= @referential.connection_links.size %></td>		
  		</tr>
  		<tr>
   		<td class="object" colspan="2"><%= Referential.human_attribute_name("stop_areas") %></td>
  		<td class="value"> <%= @referential.stop_areas.size %></td>		
  		</tr>
  		<tr>
   		<td class="image"><%= image_tag "map/boarding_position.png"%></td>
   		<td class="object"><%= Referential.human_attribute_name("boarding_positions") %></td>
  		<td class="value"> <%= @referential.stop_areas.where("area_type = ?","BoardingPosition").size %></td>		
  		</tr>
  		<tr>
   		<td class="image"><%= image_tag "map/quay.png"%></td>
   		<td class="object"><%= Referential.human_attribute_name("quays") %></td>
  		<td class="value"> <%= @referential.stop_areas.where("area_type = ?","Quay").size %></td>		
  		</tr>
  		<tr>
   		<td class="image"><%= image_tag "map/commercial_stop_point.png"%></td>
   		<td class="object"><%= Referential.human_attribute_name("commercial_stops") %></td>
  		<td class="value"> <%= @referential.stop_areas.where("area_type = ?","CommercialStopPoint").size %></td>		
  		</tr>
  		<tr>
   		<td class="image"><%= image_tag "map/stop_place.png"%></td>
   		<td class="object"><%= Referential.human_attribute_name("stop_places") %></td>
  		<td class="value"> <%= @referential.stop_areas.where("area_type = ?","StopPlace").size %></td>		
  		</tr>
  		<tr>
   		<td class="image"><%= image_tag "map/itl.png"%></td>
   		<td class="object"><%= Referential.human_attribute_name("itls") %></td>
  		<td class="value"> <%= @referential.stop_areas.where("area_type = ?","ITL").size %></td>		
  		</tr>
  	</tbody>
  </table>
  </td>
  <td valign="top" >
  <table class="count" width="75%"> 
  	<thead>
  		<tr>
  		<td><%= t('.validity_out_time_tables') %>: <%= tm_cnt = @referential.time_tables.validity_out_from_on?(Date.today).size %></td>
  		</tr>
  	</thead>
  	<tbody>
  		<% if tm_cnt > 0 %>
	  		<% @referential.time_tables.validity_out_from_on?(Date.today,5).each do |tm| %>
	  		<tr><td><%= link_to tm.comment, referential_time_table_path(@referential, tm) %></td></tr>
	  		<% end %>
	  		<% if tm_cnt > 5 %>
	  			<tr><td>...</td></tr>
            <% end %>
  		<% end %>
  	</tbody>
  	</table>
  	<p/>
  <table class="count" width="75%"> 
  	<thead>
  		<tr>
  		<td><%= t('.validity_out_soon_time_tables', :count => "7") %>: <%= tm_cnt = @referential.time_tables.validity_out_between?(Date.today,Date.today+7).size %></td>
  		</tr>
  	</thead>
  	<tbody>
  		<% if tm_cnt > 0 %>
	  		<% @referential.time_tables.validity_out_between?(Date.today,Date.today+7,5).each do |tm| %>
	  		<tr><td><%= link_to tm.comment, referential_time_table_path(@referential, tm) %></td></tr>
	  		<% end %>
	  		<% if tm_cnt > 5 %>
	  			<tr><td>...</td></tr>
            <% end %>
  		<% end %>
  	</tbody>
  	</table>
  </td>
  </tr>
  </table>
</div>  

<% content_for :sidebar do %>
<ul class="actions">
  <li><%= link_to t('referentials.actions.edit'), edit_referential_path(@referential), :class => "edit" %></li>
  <li><%= link_to t('referentials.actions.destroy'), referential_path(@referential), :method => :delete, :confirm =>  t('referentials.actions.destroy_confirm'), :class => "remove" %></li>
  <br>
</ul>

  <h3><%= t('.clean_up') %></h3>
  <div id="clean_up" >
  <%= semantic_form_for [@referential, CleanUp.new] do |form| %>
  <%= form.inputs do %> 
    <%= form.input :expected_date, :as => :date_picker , :wrapper_html => { :class => 'date' }%>
    <%= form.input :keep_lines, :as => :boolean %>
    <%= form.input :keep_stops, :as => :boolean %>
    <%= form.input :keep_companies, :as => :boolean %>
    <%= form.input :keep_networks, :as => :boolean %>
    <% end %>
    <%= form.actions do %>
      <%= form.action :submit, :as => :button, :label => t('clean_ups.actions.clean_up') , :button_html => {:confirm => t('clean_ups.actions.confirm') }%>
    <% end %>
  <% end %>
  </div>


<% end %>
