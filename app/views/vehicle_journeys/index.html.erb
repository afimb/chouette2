<ol class="breadcrumb">
  <li><%= link_to line_formatted_name( @line), [@referential, @line] %></li>
  <li><%= link_to @route.name, [@referential, @line, @route] %></li>
</ol>

<%= title_tag t('vehicle_journeys.index.title', :route => @route.name ) %>

<%= search_form_for @q, :url => referential_line_route_vehicle_journeys_path(@referential,@line,@route), remote: true, :html => {:method => :get, class: "form-inline", :id => "search", role: "form"} do |f| %>
<div class="panel panel-default">
  <div class="panel-heading clearfix">
    <div class="col-md-9">
      <%= f.collection_select :journey_pattern_id_eq, @route.journey_patterns.map{|j| j.name = journey_name(j); j}, :id, :name, :include_blank => t(".select_journey_patterns") %>
      <%= f.text_field :time_tables_id_eq, :placeholder => t(".select_time_tables"), :input_html => { :"data-pre" => [].to_json } %>      
      <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
    </div>
    <div class="col-md-3">
      <a data-toggle="collapse" data-parent="#search" href="#advanced_search" class="advanced_search_link">
        <i class="fa fa-plus"></i> <%= "#{t('.advanced_search')}" %>
      </a>
    </div>
  </div>

  <div id="advanced_search" class="panel-collapse collapse">
    <div class="panel-body">
      <input name=<%= "q[vehicle_journey_at_stops_departure_time_gt(3i)]" %> type="hidden" value="1">
      <input name=<%= "q[vehicle_journey_at_stops_departure_time_gt(2i)]" %> type="hidden" value="1">
      <input name=<%= "q[vehicle_journey_at_stops_departure_time_gt(1i)]" %> type="hidden" value="2000">
      <%= f.label :vehicle_journey_at_stops_departure_time_gt, t('.time_range') %>
      <%= select_hour(@q.send( "vehicle_journey_at_stops_departure_time_gt") ? @q.send( "vehicle_journey_at_stops_departure_time_gt").hour : 0,
                       :prefix => "q", :field_name => "vehicle_journey_at_stops_departure_time_gt(4i)") %>
      <%= select_minute(@q.send( "vehicle_journey_at_stops_departure_time_gt") ? @q.send( "vehicle_journey_at_stops_departure_time_gt").min : 0,
                         :prefix => "q", :field_name => "vehicle_journey_at_stops_departure_time_gt(5i)") %>
    </div>
  </div>
</div>
<% end %>
<div id="vehicle_journeys" ><%= render "vehicle_journeys" %></div>

<% content_for :sidebar do %>
  <%= render "sidebar" %>
<% end %>
<script>
	$(function() {
        var time_tables_url = function(){
          return '<%= referential_time_tables_path(@referential, :format => :json) %>?route_id=<%= @route.id %>';
        };
		$( "#q_time_tables_id_eq" ).tokenInput( time_tables_url, {
          crossDomain: false,
          prePopulate: $('#q_time_tables_id_eq').data('pre'),
          minChars: 3,
          queryParam: 'q[comment_cont]',
          propertyToSearch: 'comment',
          hintText: '<%= t('search_hint') %>',
          noResultsText: '<%= t('no_result_text') %>',
          searchingText: '<%= t('searching_term') %>',
          resultsFormatter: function(item){ return '<li><div class=\"name\">' + item.comment + '</div><div class=\"info\">' + item.start_date + ' ' + item.end_date + '</div></li>' },
        });
	});
</script>
